---
title: "Data Analysis Report"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r dependencies, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)

```

***

# Titanic

```{r setup_titanic, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
titanic <- read.table("resources/titanic.txt", header = TRUE)
```

## a) Overview + liniar model for Survival

### Survival based on Sex and PClass

```{r}
titanic %>%
  mutate(Survived = factor(Survived, labels = c("Died", "Survived"))) %>% 
  ggplot(aes(x = Sex, fill = Survived)) +
  geom_bar() +
  facet_wrap(~PClass) +
  labs(
    title = "Survival by Sex and PClass",
    x = "Sex",
    y = "Count",
    fill = "Survival Status"
  )
```

### Survival based on Age with respect to Sex and PClass
```{r}
titanic %>%
  mutate(Survived = factor(Survived, labels = c("Died", "Survived"))) %>% 
  ggplot(aes(x = Age, fill = Survived)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~Sex + PClass) +
  labs(x = "Age",
       y = "Count",
       title = "Survival by Age with respect to Sex and PClass",
       fill = "Survival Status")
```


We will fit a liniar model, having `Survived` as the effect and, independently, `PClass`, `Age` and `Sex` as possible causes.

```{r}
model <- glm(Survived ~ PClass + Age + Sex, data = titanic, family = binomial)
model_summary <- summary(model)$coefficients
model_summary
```

```{r}
age_effect_estimate <- summary(model)$coefficients["Age", "Estimate"]
age_p_value <- summary(model)$coefficients["Age", "Pr(>|z|)"]

pclass2nd_p_value <- summary(model)$coefficients["PClass2nd", "Pr(>|z|)"]
pclass3nd_p_value <- summary(model)$coefficients["PClass3rd", "Pr(>|z|)"]
sexmale_p_value <- summary(model)$coefficients["Sexmale", "Pr(>|z|)"]
```


We observe a low p_value (`r age_p_value`) for Age, therefore were reject the initial hypothesis and conclude that age has an effect on the Survival. Apparently, the chances of survival change with (`r age_effect_estimate`) with each year.

We observe a low p_values for PClass2nd (`r pclass2nd_p_value`), PClass3rd (`r pclass3nd_p_value`), Sexmale (`r sexmale_p_value`), therefore were reject the initial hypothesis and conclude that being 2nd class, 3rd class or being a male has an effect on the Survival. 

## b) Interactions + Studying a 55 years old person chances to survive

### Interactions

#### Age * PClass interaction

```{r}
model_age_pclass <- glm(Survived ~ Age:PClass, data = titanic, family = "binomial")
age_first_class = summary(model_age_pclass)$coefficients["Age:PClass1st", "Pr(>|z|)"]
age_second_class = summary(model_age_pclass)$coefficients["Age:PClass2nd", "Pr(>|z|)"]
age_third_class = summary(model_age_pclass)$coefficients["Age:PClass3rd", "Pr(>|z|)"]
```

Big P values (> 0.05) for Age:PClass1st (`r age_first_class`) and Age:PClass3rd (`r age_third_class`) suggest there is no strong evidence of an interaction between age and those classes passengers.

Low P value (<< 0.05) for Age:PClass2nd (`r age_second_class`) suggest therestrong evidence of an interaction between age and 2nd class of passengers.

#### Age * Sex interaction
```{r}
model_age_sex <- glm(Survived ~ Age:Sex, data = titanic, family = "binomial")
age_female = summary(model_age_sex)$coefficients["Age:Sexfemale", "Pr(>|z|)"]
age_male = summary(model_age_sex)$coefficients["Age:Sexmale", "Pr(>|z|)"]
```
Low P values (<< 0.05) for Age:Sexfemale (`r age_female`) and Age:Sexmale (age_male) suggest there is strong evidence of an interaction between age and the sex of the passenger

### Hypothetical of a 55 years old person

We build a linear model to predict `Survival` with respect to `Age`, `PClass`, `Sex` and their interactions.
```{r}
model <- glm(Survived ~ Age*PClass*Sex, data = titanic, family = "binomial")
male_first <- predict(model, data.frame(Age = 55, PClass = "1st", Sex = "male"), type = "response") 
male_second <- predict(model, data.frame(Age = 55, PClass = "2nd", Sex = "male"), type = "response") 
male_third <- predict(model, data.frame(Age = 55, PClass = "3rd", Sex = "male"), type = "response") 

female_first <- predict(model, data.frame(Age = 55, PClass = "1st", Sex = "female"), type = "response") 
female_second <- predict(model, data.frame(Age = 55, PClass = "2nd", Sex = "female"), type = "response") 
female_third <- predict(model, data.frame(Age = 55, PClass = "3rd", Sex = "female"), type = "response") 
```

  * Male
    + 55 years old `male` of `1st` class has a change of `r male_first * 100`% to survive.
    + 55 years old `male` of `2nd` class has a change of `r male_second * 100`% to survive.
    + 55 years old `male` of `3rd` class has a change of `r male_third * 100`% to survive.

  * Female
    + 55 years old `female` of `1st` class has a change of `r female_first * 100`% to survive.
    + 55 years old `female` of `2nd` class has a change of `r female_second * 100`% to survive.
    + 55 years old `female` of `3rd` class has a change of `r female_third * 100`% to survive.

Based on previous predictions we argue that a 1st class 55 years old female `r female_first * 100`% was very likely to survive, while a 2nd class 55 years old male (`r female_first * 100`%) would have likely died.

***
***
***
